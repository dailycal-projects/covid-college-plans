<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js and the geo projection plugin -->
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

<!-- Create an element where the map will take place -->
<div id="bubble_big_cal"></div>
<script>

var div = d3.select("#bubble_big_cal").append("div_bubble")
    .attr("class", "tooltip")
    .style("opacity", 0);

pageWidth = 1000
var margin = {top: 25, right: 220, bottom: 50, left: 75},
width = pageWidth - margin.left - margin.right;
width = Math.min(pageWidth, 2000 - margin.left - margin.right);
height = 0.4 * width;

// The svg
    var svg = d3.select("#bubble_cal").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Map and projection
var projection = d3.geoMercator()
    .center([-119.4179, 36.7783])                // GPS of location to zoom on
    .scale(2000)                       // This is like the zoom
    .translate([width/2, height/2])

// Create data for circles:
var markers = [
{size: 22071, group: 'CSU  Fresno State', plan: 'Planning for online', lat: 36.7783, long: -119.4179}, {size: 34468, group: 'CSU  Fullerton', plan: 'Planning for online', lat: 33.8829, long: -117.8869}, {size: 31447, group: 'CSU  Long Beach', plan: 'Planning for online', lat: 33.7838, long: -118.1141}, {size: 24002, group: 'CSU  Los Angeles', plan: 'Planning for online', lat: 34.0668, long: -118.1684}, {size: 34900, group: 'CSU  Northridge', plan: 'Planning for online', lat: 34.241, long: -118.5277}, {size: 24933, group: 'CSU  Polytechnic at Pomona', plan: 'Planning for online', lat: 34.0589, long: -117.8194}, {size: 21037, group: 'CSU  Polytechnic at San Luis Obispo', plan: 'Proposing a hybrid model', lat: 35.2828, long: -120.6596}, {size: 28317, group: 'CSU  Sacramento', plan: 'Planning for online', lat: 38.5613, long: -121.4241}, {size: 30392, group: 'CSU  San Diego State University', plan: 'Proposing a hybrid model', lat: 32.776, long: -117.0713}, {size: 26436, group: 'CSU  San Francisco State University', plan: 'Planning for online', lat: 37.7241, long: -122.4799}, {size: 27271, group: 'CSU  San Jos State University', plan: 'Planning for online', lat: 37.3352, long: -121.8811}, {size: 24187, group: 'De Anza College', plan: 'Planning for online', lat: 37.3207, long: -122.0455}, {size: 31519, group: 'Palomar College', plan: 'Proposing a hybrid model', lat: 33.1504, long: -117.1827}, {size: 30853, group: 'University of California at Berkeley', plan: 'Proposing a hybrid model', lat: 37.8719, long: -122.2585}, {size: 30718, group: 'University of California at Davis', plan: 'Proposing a hybrid model', lat: 38.5382, long: -121.7617}, {size: 29736, group: 'University of California at Irvine', plan: 'Planning for online', lat: 33.6405, long: -117.8443}, {size: 31577, group: 'University of California at Los Angeles', plan: 'Planning for online', lat: 34.0689, long: -118.4452}, {size: 20581, group: 'University of California at Riverside', plan: 'Proposing a hybrid model', lat: 33.9737, long: -117.3281}, {size: 30285, group: 'University of California at San Diego', plan: 'Proposing a hybrid model', lat: 32.8801, long: -117.234}, {size: 23070, group: 'University of California at Santa Barbara', plan: 'Considering a range of scenarios', lat: 34.414, long: -119.8489}

];

// Load external data and boot
//d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(data){
d3.json("https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json", function(data) {

    // Filter data
    data = data.features.filter( function(d){return d.properties.name=="California"} )

    // Create a color scale
    var color = d3.scaleOrdinal()
      .domain(["A", "B", "C" ])
      .range([ "#402D54", "#D18975", "#8FD175"])

    // Add a scale for bubble_cal size
    var size = d3.scaleLinear()
      .domain([1,100])  // What's in the data
      .range([ 4, 50])  // Size in pixel

    // Draw the map
    svg.append("g")
        .selectAll("path")
        .data(data)
        .enter()
        .append("path")
          .attr("fill", "#b8b8b8")
          .attr("d", d3.geoPath()
              .projection(projection)
          )
        .style("stroke", "black")
        .style("opacity", 1)

    // Add circles:
    svg
      .selectAll("myCircles")
      .data(markers)
      .enter()
      .append("circle")
        .attr("cx", function(d){ return projection([d.long, d.lat])[0] })
        .attr("cy", function(d){ return projection([d.long, d.lat])[1] })
        .attr("r", function(d){ return size((d.size / 8000) ** 2) })
        .style("fill", function(d){ return color(d.group) })
        .attr("stroke", function(d){ return color(d.group) })
        .attr("stroke-width", 3)
        .attr("fill-opacity", .6)
      .on("mouseover", function(d) {
        d3.select(this).style("fill", d3.rgb(color(d.group)).darker(2))
        div.transition()
          .duration(200)
          .style("opacity", .9)
          let p = d.group + "\n" + d.plan.toString()
          div.html(p)
              .style("left", (d3.event.pageX + 10) + "px")
              .style("top", (d3.event.pageY - 15) + "px")
              .style("font-size", "12px")
              .style("opacity", 0.7);
          })
      .on("mouseout", function(d) {
        d3.select(this).style("fill", color(d.group))
        div.transition()
          .duration(300)
          .style("opacity", 0);
      })
});

</script>
