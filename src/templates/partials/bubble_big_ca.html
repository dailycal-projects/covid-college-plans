<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js and the geo projection plugin -->
<link rel="stylesheet" href="https://use.typekit.net/mfo3lll.css">
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<center style='font-family:benton-sans'>Reopening Plans for Colleges in California</center></br>

<!-- Create an element where the map will take place -->
<div id="bubble_ca"></div>
<script>

var div = d3.select("#bubble_ca").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

var margin = {top: 0, right: 50, bottom: 0, left: 250},
width = pageWidth - margin.left - margin.right;
width = Math.min(width, 1200 - margin.left - margin.right);
height = (0.9 * width) - margin.top - margin.bottom;
if (width < 600) {height = (1.1 * width) - margin.top - margin.bottom;}

// The svg2
var svg2 = d3.select("#bubble_ca").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

scale = 3000
frac = 1
if (width < 900) {scale = 2000, frac=0.6}
if (width < 600) {scale = 1500, frac=0.5}
// Map and projection
var projection2 = d3.geoMercator()
    .center([-119.4179, 36.7783])                // GPS of location to zoom on
    .scale(scale)                       // This is like the zoom
    .translate([ width/2 - 100, height/2 ])

// Create data for circles:
var markers_ca_all = [
{size: 34900, group: 'CSU  Northridge', plan: 'Online', lat: 34.641, long: -118.5277}, {size: 34468, group: 'CSU  Fullerton', plan: 'Online', lat: 33.8829, long: -117.4869}, {size: 31447, group: 'CSU  Long Beach', plan: 'Online', lat: 33.7838, long: -118.1141}, {size: 30853, group: 'University of California at Berkeley', plan: 'Hybrid', lat: 37.8719, long: -122.2585}, {size: 30718, group: 'University of California at Davis', plan: 'Hybrid', lat: 38.5382, long: -121.7617}, {size: 30392, group: 'CSU  San Diego State University', plan: 'Hybrid', lat: 32.776, long: -117.0713}, {size: 30285, group: 'University of California at San Diego', plan: 'Hybrid', lat: 33.0, long: -117.034}, {size: 29736, group: 'University of California at Irvine', plan: 'Online', lat: 33.2405, long: -117.8443}, {size: 28317, group: 'CSU  Sacramento', plan: 'Online', lat: 38.5613, long: -121.0241}, {size: 27271, group: 'CSU  San Jose State University', plan: 'Online', lat: 37.3352, long: -121.8811}, {size: 26436, group: 'CSU  San Francisco State University', plan: 'Online', lat: 37.7241, long: -122.4799}, {size: 24933, group: 'CSU  Polytechnic at Pomona', plan: 'Online', lat: 34.0589, long: -117.8194}, {size: 24002, group: 'CSU  Los Angeles', plan: 'Online', lat: 34.0668, long: -118.1684}, {size: 23070, group: 'University of California at Santa Barbara', plan: 'Considering range of plans', lat: 34.414, long: -119.8489}, {size: 22071, group: 'CSU  Fresno State', plan: 'Online', lat: 36.7783, long: -119.4179}, {size: 21037, group: 'CSU  Polytechnic at San Luis Obispo', plan: 'Hybrid', lat: 35.2828, long: -120.6596}, {size: 20581, group: 'University of California at Riverside', plan: 'Hybrid', lat: 33.9737, long: -117.3281}, {size: 19907, group: 'University of Southern California', plan: 'Online', lat: 34.0224, long: -118.2851}, {size: 17854, group: 'CSU  San Bernardino', plan: 'Online', lat: 34.1818, long: -117.3237}, {size: 17792, group: 'University of California at Santa Cruz', plan: 'Hybrid', lat: 36.9881, long: -122.0582}, {size: 16420, group: 'CSU  Chico', plan: 'Online', lat: 39.7297, long: -121.8498}, {size: 13962, group: 'CSU  San Marcos', plan: 'Online', lat: 33.1295, long: -117.1596}, {size: 13737, group: 'CSU  Dominguez Hills', plan: 'Online', lat: 33.8653, long: -118.259}, {size: 12316, group: 'CSU  East Bay', plan: 'Online', lat: 37.6571, long: -122.0575}, {size: 9196, group: 'CSU  Bakersfield', plan: 'Online', lat: 35.3487, long: -119.1033}, {size: 9087, group: 'CSU  Stanislaus', plan: 'Online', lat: 37.5252, long: -120.8554}, {size: 8565, group: 'CSU  Sonoma State University', plan: 'Online', lat: 38.3372, long: -122.6718}, {size: 7855, group: 'California Baptist University', plan: 'In-person', lat: 33.9284, long: -117.4256}, {size: 7281, group: 'Chapman University', plan: 'In-person', lat: 33.7931, long: -117.8521}, {size: 7195, group: 'CSU  Humboldt', plan: 'Online', lat: 40.8747, long: -124.0789}, {size: 7087, group: 'Stanford University', plan: 'Hybrid', lat: 37.4275, long: -122.1697}
];
var markers_public = [
    {size: 34900, group: 'CSU  Northridge', plan: 'Online', lat: 34.641, long: -118.5277}, {size: 34468, group: 'CSU  Fullerton', plan: 'Online', lat: 33.8829, long: -117.4869}, {size: 31447, group: 'CSU  Long Beach', plan: 'Online', lat: 33.7838, long: -118.1141}, {size: 30853, group: 'University of California at Berkeley', plan: 'Hybrid', lat: 37.8719, long: -122.2585}, {size: 30718, group: 'University of California at Davis', plan: 'Hybrid', lat: 38.5382, long: -121.7617}, {size: 30392, group: 'CSU  San Diego State University', plan: 'Hybrid', lat: 32.776, long: -117.0713}, {size: 30285, group: 'University of California at San Diego', plan: 'Hybrid', lat: 33.0, long: -117.034}, {size: 29736, group: 'University of California at Irvine', plan: 'Online', lat: 33.2405, long: -117.8443}, {size: 28317, group: 'CSU  Sacramento', plan: 'Online', lat: 38.5613, long: -121.0241}, {size: 27271, group: 'CSU  San Jose State University', plan: 'Online', lat: 37.3352, long: -121.8811}, {size: 26436, group: 'CSU  San Francisco State University', plan: 'Online', lat: 37.7241, long: -122.4799}, {size: 24933, group: 'CSU  Polytechnic at Pomona', plan: 'Online', lat: 34.0589, long: -117.8194}, {size: 24002, group: 'CSU  Los Angeles', plan: 'Online', lat: 34.0668, long: -118.1684}, {size: 23070, group: 'University of California at Santa Barbara', plan: 'Considering range of plans', lat: 34.414, long: -119.8489}, {size: 22071, group: 'CSU  Fresno State', plan: 'Online', lat: 36.7783, long: -119.4179}, {size: 21037, group: 'CSU  Polytechnic at San Luis Obispo', plan: 'Hybrid', lat: 35.2828, long: -120.6596}, {size: 20581, group: 'University of California at Riverside', plan: 'Hybrid', lat: 33.9737, long: -117.3281}, {size: 17854, group: 'CSU  San Bernardino', plan: 'Online', lat: 34.1818, long: -117.3237}, {size: 17792, group: 'University of California at Santa Cruz', plan: 'Hybrid', lat: 36.9881, long: -122.0582}, {size: 16420, group: 'CSU  Chico', plan: 'Online', lat: 39.7297, long: -121.8498}, {size: 13962, group: 'CSU  San Marcos', plan: 'Online', lat: 33.1295, long: -117.1596}, {size: 13737, group: 'CSU  Dominguez Hills', plan: 'Online', lat: 33.8653, long: -118.259}, {size: 12316, group: 'CSU  East Bay', plan: 'Online', lat: 37.6571, long: -122.0575}, {size: 9196, group: 'CSU  Bakersfield', plan: 'Online', lat: 35.3487, long: -119.1033}, {size: 9087, group: 'CSU  Stanislaus', plan: 'Online', lat: 37.5252, long: -120.8554}, {size: 8565, group: 'CSU  Sonoma State University', plan: 'Online', lat: 38.3372, long: -122.6718}, {size: 7195, group: 'CSU  Humboldt', plan: 'Online', lat: 40.8747, long: -124.0789}, {size: 6813, group: 'CSU  Channel Islands', plan: 'Online', lat: 34.1621, long: -119.0435}, {size: 6716, group: 'CSU  Monterey Bay', plan: 'Online', lat: 36.6517, long: -121.7978}, {size: 1017, group: 'CSU  Maritime Academy', plan: 'Online', lat: 38.0692, long: -122.2303}
];

var markers_private = [{size: 19907, group: 'University of Southern California', plan: 'Online', lat: 34.0224, long: -118.2851}, {size: 7855, group: 'California Baptist University', plan: 'In-person', lat: 33.9284, long: -117.4256}, {size: 7281, group: 'Chapman University', plan: 'In-person', lat: 33.7931, long: -117.8521}, {size: 7087, group: 'Stanford University', plan: 'Hybrid', lat: 37.4275, long: -122.1697}, {size: 6704, group: 'University of San Francisco', plan: 'In-person', lat: 37.7766, long: -122.4507}, {size: 6700, group: 'Loyola Marymount University', plan: 'In-person', lat: 33.9702, long: -118.4166}, {size: 5855, group: 'University of San Diego', plan: 'Hybrid', lat: 32.7719, long: -117.1882}, {size: 5657, group: 'Azusa Pacific University', plan: 'In-person', lat: 34.132, long: -117.9012}, {size: 5520, group: 'Santa Clara University', plan: 'In-person', lat: 37.3496, long: -121.939}, {size: 4010, group: 'Biola University', plan: 'In-person', lat: 33.9054, long: -118.0152}, {size: 3628, group: 'University of the Pacific', plan: 'Hybrid', lat: 37.9799, long: -121.3129}, {size: 3627, group: 'Pepperdine University', plan: 'In-person', lat: 34.0414, long: -118.7096}, {size: 3196, group: 'Point Loma Nazarene University', plan: 'In-person', lat: 32.718, long: -117.2503}, {size: 3059, group: 'California Lutheran University', plan: 'Considering range of plans', lat: 34.2249, long: -118.8789}, {size: 3014, group: 'University of Redlands', plan: 'Hybrid', lat: 34.0627, long: -117.1633}, {size: 2798, group: 'University of La Verne', plan: 'In-person', lat: 34.1008, long: -117.773}, {size: 2689, group: "Saint Mary's College of California", plan: 'Hybrid', lat: 37.8413, long: -122.1101}, {size: 2036, group: 'Occidental College', plan: 'Hybrid', lat: 34.1273, long: -118.2101}, {size: 1848, group: 'Vanguard University', plan: 'In-person', lat: 33.6617, long: -117.9011}, {size: 1808, group: 'Concordia University Irvine', plan: 'In-person', lat: 33.6539, long: -117.8105}, {size: 1679, group: 'Pomona College', plan: 'Waiting to decide', lat: 34.0973, long: -117.7131}, {size: 1399, group: "Master's University", plan: 'In-person', lat: 34.3825, long: -118.5193}, {size: 1355, group: 'Dominican University of California', plan: 'In-person', lat: 37.9798, long: -122.5132}, {size: 1277, group: 'Westmont College', plan: 'In-person', lat: 34.4488, long: -119.661}, {size: 1257, group: 'William Jessup University', plan: 'In-person', lat: 38.8204, long: -121.2925}, {size: 1200, group: 'Claremont Colleges', plan: 'In-person', lat: 34.1014, long: -117.7139}, {size: 1059, group: 'Woodbury University', plan: 'Hybrid', lat: 34.2077, long: -118.3413}, {size: 1048, group: 'Scripps College', plan: 'Waiting to decide', lat: 34.1038, long: -117.711}, {size: 1010, group: 'California Institute of the Arts', plan: 'Hybrid', lat: 34.3927, long: -118.5672}, {size: 948, group: 'California Institute of Technology', plan: 'Waiting to decide', lat: 34.1377, long: -118.1253}, {size: 889, group: 'Harvey Mudd College', plan: 'Waiting to decide', lat: 34.1057, long: -117.7096}, {size: 790, group: 'Simpson University', plan: 'In-person', lat: 40.6144, long: -122.3323}, {size: 775, group: 'Menlo College', plan: 'In-person', lat: 37.4561, long: -122.1921}, {size: 683, group: 'Hope International University', plan: 'In-person', lat: 33.8768, long: -117.8854}];

// Load external data and boot
//d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(data){
//d3.json("https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json", function(data) {
d3.json("https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.json", function(data) {

    // Filter data
    data = data.features.filter( function(d){return d.properties.name=="California"} )

    // Create a color scale
    var color = d3.scaleOrdinal()
      .domain(['In-person', 'Hybrid',
       'Online', 'Considering range of plans',
       'Waiting to decide'])
       .range([ "#d18975", "#8F679C",  "#338A6C","#479BD1", "#f4803f", ])

    // Add a scale for bubble size
    var size = d3.scaleLinear()
      .domain([1,100])  // What's in the data
      .range([ 4, 50])  // Size in pixel
      var legend = svg2.append("g")
          .style("font-family", "benton-sans")
          .style("font-size", 14)
          .attr("text-anchor", "start")
        .selectAll("g")
        .data(['In-person', 'Hybrid',
         'Online', 'Considering range of plans',
         'Waiting to decide'])
        .enter().append("g")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
      legend.append("rect")
          .attr("x", width - 400)
          .attr("y", 0 - 20)
          .attr("width", 12)
          .attr("height", 12)
          .attr("fill", color)
          .attr("opacity", 0.8);
      legend.append("text")
          .attr("x", width - 380)
          .attr("y", 0 - 14)
          .attr("dy", "0.32em")
          .text(function(d) { return d; });

    // Draw the map
    svg2.append("g")
        .selectAll("path")
        .data(data)
        .enter()
        .append("path")
          .attr("fill", "#b8b8b8")
          .attr("d", d3.geoPath()
              .projection(projection2)
          )
        .style("stroke", "black")
        .style("opacity", 0.5)

    // Add circles:
    svg2
      .selectAll("circles_ca")
      .data(markers_ca_all)
      .enter()
      .append("circle")
        .attr("cx", function(d){ return projection2([d.long, d.lat])[0] })
        .attr("cy", function(d){ return projection2([d.long, d.lat])[1] })
        .attr("r", function(d){ return size(frac * Math.log(d.size / 500) * 10) })
        .style("fill", function(d){ return color(d.plan) })
        .attr("stroke", "white")
        .attr("stroke-width", 0.8)
        .attr("fill-opacity", .7)
      .on("mouseover", function(d) {
        d3.select(this).style("fill", d3.rgb(color(d.plan)).darker(2))
        div.transition()
          .duration(200)
          .style("opacity", .9)
          let p = "<strong>School</strong>: " + d.group + "<br />" + "<strong>Enrollment</strong>: " + d3.format(",")(d.size).toString() + "<br />" + "<strong>Plan</strong>: " + d.plan.toString()
          div.html(p)
              .style("width", "210px")
              .style("height", "130px")
              .style("text-align", "left")
              .style("left", (d3.event.pageX + 10) + "px")
              .style("top", (d3.event.pageY - 15) + "px")
              .style("font-size", "18x")
              .style("opacity", 0.7);
          })
      .on("mouseout", function(d) {
        d3.select(this).style("fill", color(d.plan))
        div.transition()
          .duration(300)
          .style("opacity", 0);
      })
});

</script>
